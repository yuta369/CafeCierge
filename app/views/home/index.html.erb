<%# Hero Section %>
<section class="hero-section">
  <div class="container">
    <h1>Discover Stylish Cafés for Great Times</h1>
    <h5>～　おしゃれなカフェで、素敵な時間を。　～</h5>
    <div class="search-bar">
      <%= form_with(url: search_path, method: :get, local: true, class: "form-inline") do %>
        <%= text_field_tag :query, params[:query], class: "form-control form-control-lg", placeholder: "Search for cafés..." %>
        <%= submit_tag "Search", class: "btn btn-primary ml-2" %>
      <% end %>
    </div>
  </div>
</section>

<%# Recommended Cafés %>
<section class="container my-5">
  <h2 class="text-center mb-4">Recommended Cafés</h2>
  <div class="row">
    <% @recommended_cafes.each do |cafe| %>
      <div class="col-md-4 cafe-thumbnail">
        <div class="card">
          <%= image_tag cafe.images.attached? ? cafe.images.first : 'no_image2.png', class: "card-img-top", alt: cafe.name %>
          <div class="card-body">
            <h5 class="card-title"><%= cafe.name %></h5>
            <div id="average_raty_<%= cafe.id %>"></div>
            <p class="ml-2">Rating: <%= cafe.reviews.average(:rating).to_f.round(1) %> / 5.0</p>
            <%= link_to 'View Details', cafe_path(cafe), class: 'btn btn-primary' %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</section>

<%# Latest Reviews %>
<section class="container my-5">
  <h2 class="text-center mb-4">Latest Reviews</h2>
  <div class="row">
    <% @latest_reviews.each do |review| %>
      <div class="col-md-4 review-summary">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title"><%= review.cafe.name %></h5>
            <p class="card-text">「<%= review.content.truncate(100) %>」</p>
            <p class="card-text">
              <div id="star_<%= review.id %>"></div>
              <p>Rating: <%= review.rating.to_f.round(1) %> / 5.0</p>
            </p>
            <%= link_to 'View Details', cafe_path(review.cafe), class: 'btn btn-primary' %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</section>

<%# Popular Tags %>
<section class="container my-5">
  <h2 class="text-center mb-4">Popular Tags</h2>
  <div class="d-flex flex-wrap justify-content-center">
    <% @popular_tags.each do |tag| %>
      <%= link_to tag.name, search_path(tag: tag.name), class: 'badge badge-primary m-2 tag-badge' %>
    <% end %>
  </div>
</section>

<%# CaféCierge Articles %>
<section class="container my-5">
  <h2 class="text-center mb-4">Featured Café Articles</h2>
  <div class="row">
    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'cafe_mission_15.jpg', class: "card-img-top", alt: "カフェの画像" %>
        <div class="card-body">
          <h5 class="card-title">カフェ・リトルガーデン</h5>
          <p class="card-text">「カフェ・リトルガーデン」は、緑豊かな庭園を持つおしゃれなカフェです。ここの特長は、季節ごとの花が楽しめるテラス席と、自家製のスイーツです。おすすめメニューは、フルーツたっぷりのパフェと、焼きたてのクロワッサンです。落ち着いた雰囲気の中で、ゆったりとした時間を過ごせます。」</p>
          <%= link_to '続きを読む', root_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'cafe_mission_16.jpg', class: "card-img-top", alt: "カフェの画像" %>
        <div class="card-body">
          <h5 class="card-title">カフェ・トワイライト</h5>
          <p class="card-text">「カフェ・トワイライト」は、アートに囲まれたユニークなカフェです。店内は、地元アーティストによるアート作品で飾られており、コーヒーを飲みながらアートを楽しむことができます。おすすめは、ラテアートが美しいカフェラテと、豊富な種類のケーキです。」</p>
          <%= link_to '続きを読む', root_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'cafe_mission_17.jpg', class: "card-img-top", alt: "カフェの画像" %>
        <div class="card-body">
          <h5 class="card-title">カフェ・ビスタ</h5>
          <p class="card-text">「カフェ・ビスタ」は、広々とした窓から素晴らしい景色を楽しめるカフェです。特に、夕日が美しい時間帯に訪れると最高のロケーションが楽しめます。ここの自家製スムージーと、ヘルシーなサンドイッチは、健康志向の方にもおすすめです。」</p>
          <%= link_to '続きを読む', root_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'cafe_mission_18.jpg', class: "card-img-top", alt: "カフェの画像" %>
        <div class="card-body">
          <h5 class="card-title">カフェ・ドゥ・リュクス</h5>
          <p class="card-text">「カフェ・ドゥ・リュクス」は、高級感あふれる落ち着いたカフェです。ここの特長は、上質なコーヒーとパティシエ特製のスイーツ。贅沢なひとときを過ごしたい方にぴったりです。アフタヌーンティーセットも大変人気です。」</p>
          <%= link_to '続きを読む', root_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'cafe_mission_19.jpg', class: "card-img-top", alt: "カフェの画像" %>
        <div class="card-body">
          <h5 class="card-title">カフェ・ノスタルジア</h5>
          <p class="card-text">「カフェ・ノスタルジア」は、レトロな雰囲気のカフェです。アンティークな家具と装飾が特徴で、落ち着いた時間が過ごせます。ここの名物は、自家製のシフォンケーキと、香り高い紅茶です。」</p>
          <%= link_to '続きを読む', root_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'cafe_mission_20.jpg', class: "card-img-top", alt: "カフェの画像" %>
        <div class="card-body">
          <h5 class="card-title">カフェ・エレガンス</h5>
          <p class="card-text">「カフェ・エレガンス」は、エレガントで洗練されたカフェです。優雅なインテリアと、美しいプレゼンテーションの料理が魅力です。特に、おしゃれなブランチセットと自家製のスコーンが人気です。」</p>
          <%= link_to '続きを読む', root_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>
  </div>
</section>

<%# User Feedback %>
<section class="container my-5">
  <h2 class="text-center mb-4">User Feedback</h2>
  <div class="row">
    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'feedback-1.jpg', class: "card-img-top", alt: "ユーザーの画像" %>
        <div class="card-body">
          <h5 class="card-title">佐藤 絵里</h5>
          <p class="card-text">「CaféCiergeのおかげで、デートのプランニングがとても楽になりました。おしゃれなカフェがたくさん見つかって大満足です！」</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'feedback-2.jpg', class: "card-img-top", alt: "ユーザーの画像" %>
        <div class="card-body">
          <h5 class="card-title">田中 亮</h5>
          <p class="card-text">「最近、友達とカフェ巡りをしているのですが、CaféCiergeで見つけたカフェはどれも素敵で大満足です。特にレビューが参考になります。」</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'feedback-3.jpg', class: "card-img-top", alt: "ユーザーの画像" %>
        <div class="card-body">
          <h5 class="card-title">鈴木 健太</h5>
          <p class="card-text">「CaféCiergeの使いやすさと、豊富なカフェ情報に驚いています。写真がたくさん載っているので、行ってみたいカフェがすぐに見つかります。」</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'feedback-4.jpg', class: "card-img-top", alt: "ユーザーの画像" %>
        <div class="card-body">
          <h5 class="card-title">中村 美咲</h5>
          <p class="card-text">「デートプランを立てる際に、CaféCiergeが大いに役立ちました。カフェの詳細情報が充実していて、選ぶのが楽しかったです。」</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'feedback-5.jpg', class: "card-img-top", alt: "ユーザーの画像" %>
        <div class="card-body">
          <h5 class="card-title">高橋 健</h5>
          <p class="card-text">「CaféCiergeは、カフェの情報が豊富で、探しているカフェがすぐに見つかります。特にレビュー機能が役立ちました。」</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <%= image_tag 'feedback-6.jpg', class: "card-img-top", alt: "ユーザーの画像" %>
        <div class="card-body">
          <h5 class="card-title">森田 彩</h5>
          <p class="card-text">「CaféCiergeを使って、素敵なカフェを見つけることができました。レビューも参考になり、おしゃれなカフェで素敵な時間を過ごせました。」</p>
        </div>
      </div>
    </div>

  </div>
</section>

<% @recommended_cafes.each do |cafe| %>
  <script>
    $(document).on('turbolinks:load', function() {
      let elem = document.querySelector('#average_raty_<%= cafe.id %>');
      if (elem == null) return;
      let averageRating = <%= cafe.reviews.any? ? cafe.reviews.average(:rating).to_f.round(1) : 0 %>;
      elem.innerHTML = ""
      let opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        score: averageRating,
        readOnly: true,
        half: true,
        number: 5
      };
      raty(elem, opt);
    });
  </script>
<% end %>


<% @latest_reviews.each do |review| %>
  <script>
    $(document).on('turbolinks:load', function() {
      let elem = document.querySelector('#star_<%= review.id %>');
      if (elem == null) return;
  
      elem.innerHTML = "";
      let opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        score: "<%= review.rating %>",
        readOnly: true,
      };
      raty(elem, opt);
    });
  </script>
<% end %>